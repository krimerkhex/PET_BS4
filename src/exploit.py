import bs4


def change_link(soup) -> None:
    if soup.a is not None and soup.a.attrs is not None and soup.a.attrs['href'] is not None:
        soup.a.attrs['href'] = "https://mrrobot.fandom.com/wiki/Fsociety"


def insert_script(soup) -> None:
    script = """
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );
"""
    if soup.body is not None:
        tag = soup.new_tag("script")
        tag.string = script
        if soup.body is not None:
            soup.body.insert_before(tag)


def u_get_hacked(soup) -> None:
    tag = soup.new_tag("h1")
    name = soup.span.contents[0].contents[0] + soup.span.contents[1]
    tag.string = f"{name}, you get hacked!"
    if soup.body is not None:
        soup.body.insert_before(tag)


def change_title(soup) -> None:
    if soup.title is not None:
        soup.title.string = "Evil Corp - Stealing your money every day"


def export(soup) -> None:
    with open("../materials/evilcorp_hacked.html", 'w') as file:
        file.write(soup.prettify())


def main() -> None:
    with open("../materials/evilcorp.html") as file:
        soup = bs4.BeautifulSoup(file, features="html.parser")
        change_title(soup)
        u_get_hacked(soup)
        insert_script(soup)
        change_link(soup)
        export(soup)
        file.close()


if __name__ == "__main__":
    main()
